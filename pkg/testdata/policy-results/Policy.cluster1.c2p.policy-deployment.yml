apiVersion: policy.open-cluster-management.io/v1
kind: Policy
metadata:
  annotations:
    kubectl.kubernetes.io/last-applied-configuration: |
      {"apiVersion":"policy.open-cluster-management.io/v1","kind":"Policy","metadata":{"annotations":{"policy.open-cluster-management.io/categories":"","policy.open-cluster-management.io/controls":"cm-2","policy.open-cluster-management.io/standards":""},"name":"policy-deployment","namespace":"c2p"},"spec":{"disabled":false,"policy-templates":[{"objectDefinition":{"apiVersion":"policy.open-cluster-management.io/v1","kind":"ConfigurationPolicy","metadata":{"name":"policy-deployment"},"spec":{"namespaceSelector":{"exclude":["kube-system","open-cluster-management","open-cluster-management-agent","open-cluster-management-agent-addon"],"include":["*"]},"object-templates":[{"complianceType":"musthave","objectDefinition":{"apiVersion":"apps/v1","kind":"Deployment","metadata":{"labels":{"app":"nginx"},"name":"nginx-deployment"},"spec":{"replicas":3,"selector":{"matchLabels":{"app":"nginx"}},"template":{"metadata":{"labels":{"app":"nginx"}},"spec":{"containers":[{"image":"nginx:1.21.4","name":"nginx","ports":[{"containerPort":80}]}]}}}}}],"remediationAction":"inform","severity":"low"}}}],"remediationAction":"inform"}}
    policy.open-cluster-management.io/categories: ""
    policy.open-cluster-management.io/controls: cm-2
    policy.open-cluster-management.io/standards: ""
  creationTimestamp: "2023-07-05T23:52:32Z"
  generation: 1
  labels:
    policy.open-cluster-management.io/cluster-name: cluster1
    policy.open-cluster-management.io/cluster-namespace: cluster1
    policy.open-cluster-management.io/root-policy: c2p.policy-deployment
  name: c2p.policy-deployment
  namespace: cluster1
  resourceVersion: "58997"
  uid: 3d7bf6b3-4332-4195-81b4-d343a847c3f8
spec:
  disabled: false
  policy-templates:
    - objectDefinition:
        apiVersion: policy.open-cluster-management.io/v1
        kind: ConfigurationPolicy
        metadata:
          name: policy-deployment
        spec:
          namespaceSelector:
            exclude:
              - kube-system
              - open-cluster-management
              - open-cluster-management-agent
              - open-cluster-management-agent-addon
            include:
              - '*'
          object-templates:
            - complianceType: musthave
              objectDefinition:
                apiVersion: apps/v1
                kind: Deployment
                metadata:
                  labels:
                    app: nginx
                  name: nginx-deployment
                spec:
                  replicas: 3
                  selector:
                    matchLabels:
                      app: nginx
                  template:
                    metadata:
                      labels:
                        app: nginx
                    spec:
                      containers:
                        - image: nginx:1.21.4
                          name: nginx
                          ports:
                            - containerPort: 80
          remediationAction: inform
          severity: low
  remediationAction: inform
status:
  compliant: NonCompliant
  details:
    - compliant: NonCompliant
      history:
        - eventName: c2p.policy-deployment.176f1ddc5591cb1c
          lastTimestamp: "2023-07-05T23:53:37Z"
          message: 'NonCompliant; violation - deployments not found: [nginx-deployment] in namespace cluster1 missing; [nginx-deployment] in namespace kube-node-lease missing; [nginx-deployment] in namespace kube-public missing; [nginx-deployment] in namespace local-path-storage missing'
        - eventName: c2p.policy-deployment.176f1dc090333b1b
          lastTimestamp: "2023-07-05T23:51:38Z"
          message: 'NonCompliant; violation - deployments not found: [nginx-deployment] in namespace cluster1 missing; [nginx-deployment] in namespace kube-node-lease missing; [nginx-deployment] in namespace kube-public missing; [nginx-deployment] in namespace local-path-storage missing'
        - eventName: c2p.policy-deployment.176f1bee3daf20de
          lastTimestamp: "2023-07-05T23:18:15Z"
          message: 'NonCompliant; violation - deployments not found: [nginx-deployment] in namespace cluster1 missing; [nginx-deployment] in namespace kube-node-lease missing; [nginx-deployment] in namespace kube-public missing; [nginx-deployment] in namespace local-path-storage missing'
      templateMeta:
        creationTimestamp: null
        name: policy-deployment
